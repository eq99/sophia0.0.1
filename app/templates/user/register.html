{% extends 'base.html' %}

{% block article %}
<form action="/signin" method="POST">
  <div class="form-group row">
    <div class="col-sm-10">
      <small id="passwordHelpBlock" class="form-text text-muted">
        请填写有效的邮箱, 我们会向此邮箱发送验证码.
      </small>
      <input type="email" class="form-control" name="email" id="email" placeholder="请填写邮箱">
    </div>
  </div>

  <div class="form-group row">
    <div class="input-group mb-3 col-sm-10">
      <input type="text" class="form-control" name="code" id="code" placeholder="请填写验证码" aria-label="code" aria-describedby="basic-addon2">
      <div class="input-group-append">
        <button class="btn btn-outline-secondary" id="code-send-button" type="button">发送验证码到邮箱</button>
      </div>
    </div>
  </div>
  <div class="form-group row">
    <div class="col-sm-10">
      <input type="password" class="form-control" name="password" id="password" placeholder="密码">
    </div>
  </div>
  <div class="form-group row">
    <div class="col-sm-10">
      <input type="password" class="form-control" name="confirm-password" id="confirm-password" placeholder="确认密码">
    </div>
  </div>
  <div class="form-group row">
      <button type="submit" class="btn btn-primary col-sm-10" id='submit-button'>注册</button>
  </div>
</form>
{% endblock %}

{% block script %}
	<script type="text/javascript">

    const EmailInput = document.getElementById('email');
    const CodeInput = document.getElementById('code');
    const PasswordInput = document.getElementById('password');
    const ConfirmPasswordInput = document.getElementById('confirm-password');
    const CodeSendButton = document.getElementById('code-send-button');
    const EmailInfo = document.getElementById('email-info');

    function insertAfter(referenceNode, newNode) {
      referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);
    }

    CodeSendButton.addEventListener("click", function (e) {
      e.preventDefault();

      let formData = new FormData();
      formData.append('email', EmailInput.value);
      fetch('/code', {
        method: 'POST',
        body: formData
      })
      .then(response => {return response.json()})
      .then(data => {
        if (data.code === 200){
          EmailInput.classList.add('is-valid');
        }else{
          EmailInput.classList.add('is-invalid');

        }
      })
      .catch((error) => {
        console.log('Error:', error);
      });

    });
	</script>
{% endblock %}
